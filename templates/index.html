<!DOCTYPE html>
<html>
  <head>
    <title>Global News Topic Tracker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 40px 20px;
        background: #f5f5f5;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 { color: #333; margin-bottom: 30px; text-align: center; }
      .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 30px 20px;
        width: 100%;
        max-width: 1400px;
        padding: 0 10px;
      }
      .article {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .title { font-weight: bold; color: #0077cc; margin-bottom: 12px; font-size: 20px; }
      .summary { color: #555; font-size: 15px; line-height: 1.5; }
      .dark-mode { background: #1e1e1e; color: #ddd; }
      .dark-mode .article { background: #2c2c2c; color: #ddd; }
      .dark-mode .title { color: #66aaff; }
      .dark-mode a { color: #66aaff; }
      .toggle-button {
        position: fixed;
        top: 20px;
        right: 20px;
        border: none;
        background: transparent;
        cursor: pointer;
        font-size: 24px;
      }
      @media (max-width: 900px) {
        .grid-container { grid-template-columns: repeat(2, 1fr); }
      }
      @media (max-width: 600px) {
        .grid-container { grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <button class="toggle-button" onclick="toggleDarkMode()">ðŸŒ™</button>
    <h1>ðŸ“° Global News Topic Tracker</h1>

    <div class="grid-container" id="news-container">
      {% for s in summaries %}
      <div class="article">
        <div class="title">{{ s.title }}</div>
        <div class="summary">{{ s.summary }}</div>
        <a href="{{ s.link }}" target="_blank" style="margin-top: 10px; color: #0077cc; font-size: 14px; text-decoration: none;">ðŸ”— Read More</a>
      </div>
      {% endfor %}
    </div>

    <p id="loading" style="margin:20px; display:none;">Loading more news...</p>

    <script>
      let currentPage = 1;
      let loading = false;

      async function loadMoreNews() {
        if (loading) return;
        loading = true;
        document.getElementById("loading").style.display = "block";

        try {
          currentPage++;
          const res = await fetch(`/load_news?page=${currentPage}`);
          const data = await res.json();

          const container = document.getElementById("news-container");
          data.forEach(s => {
            const article = document.createElement("div");
            article.classList.add("article");
            article.innerHTML = `
              <div class="title">${s.title}</div>
              <div class="summary">${s.summary}</div>
              <a href="${s.link}" target="_blank" style="margin-top:10px; color:#0077cc; font-size:14px; text-decoration:none;">ðŸ”— Read More</a>
            `;
            container.appendChild(article);
          });
        } catch (err) {
          console.error("Error loading news:", err);
        } finally {
          loading = false;
          document.getElementById("loading").style.display = "none";
        }
      }

      window.addEventListener("scroll", () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
          loadMoreNews();
        }
      });

      // Dark mode restore
      if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
      }
      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
      }
    </script>
  </body>
</html>
